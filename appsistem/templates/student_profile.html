{% extends 'index.html' %}
{% load static %}
{% block title %}Mi Perfil | SRP{% endblock %}
{% block breadcrumb %}
  <a href="{% url 'inicio' %}" class="text-gray-500 hover:text-ucs-red transition-colors">Inicio</a>
  <i class="fas fa-chevron-right text-gray-400 text-xs"></i>
  <span class="text-ucs-red font-medium">Mi Perfil</span>
{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8">
  <!-- Información -->
  <div class="lg:col-span-2 order-2 lg:order-1">
    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
      <div class="px-4 sm:px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900 flex items-center">
          <i class="fas fa-user-edit mr-2 text-ucs-red"></i>Actualizar Información
        </h3>
      </div>
      <div class="p-4 sm:p-6">
        <form method="post" class="space-y-6">
          {% csrf_token %}
          <input type="hidden" name="action" value="update_info" />
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-user mr-1 text-ucs-red"></i>Nombres
              </label>
              <input class="w-full border-2 border-gray-200 rounded-lg px-4 py-3 focus:border-ucs-red focus:ring-2 focus:ring-red-100 transition-all"
                     name="first_name" value="{{ user_obj.first_name }}" placeholder="Ingresa tus nombres" />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-user mr-1 text-ucs-red"></i>Apellidos
              </label>
              <input class="w-full border-2 border-gray-200 rounded-lg px-4 py-3 focus:border-ucs-red focus:ring-2 focus:ring-red-100 transition-all"
                     name="last_name" value="{{ user_obj.last_name }}" placeholder="Ingresa tus apellidos" />
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-envelope mr-1 text-ucs-red"></i>Correo Electrónico
            </label>
            <input class="w-full border-2 border-gray-200 rounded-lg px-4 py-3 focus:border-ucs-red focus:ring-2 focus:ring-red-100 transition-all"
                   type="email" name="email" value="{{ user_obj.email }}" placeholder="correo@ejemplo.com" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-id-card mr-1 text-ucs-red"></i>Usuario
            </label>
            <input class="w-full border-2 border-gray-200 rounded-lg px-4 py-3 focus:border-ucs-red focus:ring-2 focus:ring-red-100 transition-all"
                   name="username" value="{{ user_obj.username }}" placeholder="Cédula (7 u 8 dígitos)"
                   pattern="^\d{7,8}$" minlength="7" maxlength="8" inputmode="numeric" title="Solo números, 7 u 8 dígitos" />
          </div>
          <div class="pt-4">
            <button type="submit" class="inline-flex items-center px-6 py-3 bg-ucs-red text-white rounded-lg hover:bg-red-700 transition-colors font-medium">
              <i class="fas fa-save mr-2"></i>Guardar Información
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Contraseña y foto -->
  <div class="order-1 lg:order-2 space-y-6">
    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
      <div class="px-4 sm:px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900 flex items-center">
          <i class="fas fa-key mr-2 text-green-600"></i>Cambiar Contraseña
        </h3>
      </div>
      <div class="p-4 sm:p-6">
        <form method="post" class="space-y-4">
          {% csrf_token %}
          <input type="hidden" name="action" value="change_password" />
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-lock mr-1 text-green-600"></i>Contraseña Actual
            </label>
            <input class="w-full border-2 border-gray-200 rounded-lg px-4 py-3 focus:border-green-500 focus:ring-2 focus:ring-green-100 transition-all"
                   type="password" name="current_password" required placeholder="Contraseña actual" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-lock mr-1 text-green-600"></i>Nueva Contraseña
            </label>
            <input class="w-full border-2 border-gray-200 rounded-lg px-4 py-3 focus:border-green-500 focus:ring-2 focus:ring-green-100 transition-all"
                   type="password" name="new_password1" required placeholder="Nueva contraseña" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-lock mr-1 text-green-600"></i>Confirmar Contraseña
            </label>
            <input class="w-full border-2 border-gray-200 rounded-lg px-4 py-3 focus:border-green-500 focus:ring-2 focus:ring-green-100 transition-all"
                   type="password" name="new_password2" required placeholder="Confirmar nueva contraseña" />
          </div>
          <button type="submit" class="w-full inline-flex items-center justify-center px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium">
            <i class="fas fa-shield-alt mr-2"></i>Cambiar Contraseña
          </button>
        </form>
      </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
      <div class="px-4 sm:px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900 flex items-center">
          <i class="fas fa-camera mr-2 text-purple-600"></i>Foto de Perfil
        </h3>
      </div>
      <div class="p-4 sm:p-6">
        <div class="text-center mb-6">
          {% with p=user_obj.profile.photo %}
            {% if p %}
              <img src="{{ p.url }}" class="w-24 h-24 rounded-full object-cover border-4 border-gray-200 mx-auto mb-3" alt="Foto de perfil">
            {% else %}
              <img src="{% static 'img/user.png' %}" class="w-24 h-24 rounded-full object-cover border-4 border-gray-200 mx-auto mb-3" alt="Foto de perfil por defecto">
            {% endif %}
          {% endwith %}
          <p class="text-sm text-gray-600">Foto actual del perfil</p>
        </div>

        <form method="post" enctype="multipart/form-data" class="space-y-4">
          {% csrf_token %}
          <input type="hidden" name="action" value="update_photo" />
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-upload mr-1 text-purple-600"></i>Seleccionar Nueva Foto
            </label>
            <input type="file" name="photo" accept="image/*" required
                   class="block w-full text-sm file:mr-3 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-purple-100 file:text-purple-700 hover:file:bg-purple-200 file:transition-colors border border-gray-300 rounded-lg" />
            <p class="text-xs text-gray-500 mt-1">
              <i class="fas fa-info-circle mr-1"></i>Formatos soportados: JPG, PNG. Tamaño recomendado: 256x256px
            </p>
          </div>
          <button type="submit" class="w-full inline-flex items-center justify-center px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium">
            <i class="fas fa-camera mr-2"></i>Actualizar Foto
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}